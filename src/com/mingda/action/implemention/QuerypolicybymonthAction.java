/*
 * Generated by MyEclipse Struts
 * Template path: templates/java/JavaClass.vtl
 */
package com.mingda.action.implemention;

import java.util.List;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.apache.log4j.Logger;
import org.apache.struts.action.Action;
import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;
import org.hibernate.Query;
import org.hibernate.Session;
import org.hibernate.Transaction;

import com.mingda.common.SessionFactory;

public class QuerypolicybymonthAction extends Action {

	static Logger log = Logger.getLogger(QuerypolicybymonthAction.class);

	@SuppressWarnings("rawtypes")
	public ActionForward execute(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) {

		String monthid = request.getParameter("imonthId");
		String familyId = request.getParameter("familyId");

		Session session = SessionFactory.getSession();
		Transaction tx = session.beginTransaction();

		try {
			String sql = "select impl_t_accoptcheck.family_id, "
					+ " impl_t_accoptcheck.member_id, "
					+ " impl_t_accoptcheck.countmoney, "
					+ " impl_t_accoptcheck.checkmoney, "
					+ " impl_t_accoptcheck.checkchildmoney"
					+ ", doper_t_policy.name, biz_t_optacc.accyear ,biz_t_optacc.accmonth"
					+ " from biz_t_optacc, "
					+ " impl_t_month_optacc, "
					+ " impl_t_month, "
					+ " impl_t_accoptcheck, "
					+ " doper_t_policy "
					+ " where impl_t_month.month_id = '"
					+ monthid
					+ "' "
					+ " and impl_t_accoptcheck.family_id = '"
					+ familyId
					+ "' "
					+ " and biz_t_optacc.optacc_id = impl_t_month_optacc.optacc_id "
					+ " and impl_t_month.month_id = impl_t_month_optacc.month_id "
					+ " and biz_t_optacc.policy_id = impl_t_accoptcheck.policy_id "
					+ " and biz_t_optacc.optacc_id = impl_t_accoptcheck.optacc_id "
					+ " and doper_t_policy.policy_id = biz_t_optacc.policy_id "
					+ " and doper_t_policy.policy_id = impl_t_accoptcheck.policy_id";

			log.error("view:::: " + sql);

			Query q = session.createSQLQuery(sql);
			List list = q.list();
			request.setAttribute("list", list);
			tx.commit();
		} catch (RuntimeException re) {
			re.printStackTrace();
		} finally {
			session.close();
		}
		return mapping.findForward("querypolicybymonth");
	}
}