<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="InfoTMember">

	<!-- Use type aliases to avoid typing the full classname every time. -->
	<typeAlias alias="InfoTMember" type="com.mingda.common.ibatis.data.InfoTMember" />

	<!--
		Result maps describe the mapping between the columns returned from a
		query, and the class properties. A result map isn't necessary if the
		columns (or aliases) match to the properties exactly.
	-->
	<resultMap id="InfoTMemberResult" class="com.mingda.common.ibatis.data.InfoTMember">
		<result property="memberId" column="MEMBER_ID" />
		<result property="familyId" column="FAMILY_ID" />
		<result property="relmaster" column="RELMASTER" />
		<result property="membername" column="MEMBERNAME" />
		<result property="papertype" column="PAPERTYPE" />
		<result property="paperid" column="PAPERID" />
		<result property="birthday" column="BIRTHDAY" />
		<result property="sex" column="SEX" />
		<result property="nation" column="NATION" />
		<result property="ismarriage" column="ISMARRIAGE" />
		<result property="political" column="POLITICAL" />
		<result property="rprkind" column="RPRKIND" />
		<result property="rprtype" column="RPRTYPE" />
		<result property="rpraddress" column="RPRADDRESS" />
		<result property="degreesort" column="DEGREESORT" />
		<result property="policy" column="POLICY" />
		<result property="ftap" column="FTAP" />
		<result property="ftaplevel" column="FTAPLEVEL" />
		<result property="sicken" column="SICKEN" />
		<result property="deformity" column="DEFORMITY" />
		<result property="oldandinfirm" column="OLDANDINFIRM" />
		<result property="workability" column="WORKABILITY" />
		<result property="picpath" column="PICPATH" />
		<result column="STUDENT" property="student" />
		<result column="HEALTH" property="health" />
		<result column="OTHERREASON" property="otherreason" />
		<result column="INDI_ID" property="indiId" />
	</resultMap>
	<select id="selectMemberById" parameterClass="int" resultMap="InfoTMemberResult">
		SELECT * FROM INFO_T_MEMBER WHERE MEMBER_ID =#memberId# order by
		RELMASTER
	</select>
	<select id="selectMemberByFamilyId" parameterClass="int"
		resultMap="InfoTMemberResult">
		SELECT * FROM INFO_T_MEMBER WHERE FAMILY_ID =#familyId#
		order by RELMASTER
	</select>
	<select id="selectMaster" parameterClass="InfoTMember"
		resultMap="InfoTMemberResult">
		SELECT * FROM INFO_T_MEMBER WHERE FAMILY_ID =#familyId# and
		RELMASTER =#relmaster#
	</select>
	<insert id="insertMember" parameterClass="InfoTMember">
		<!--  <selectKey resultClass="int" keyProperty="memberId" type="pre">
			SELECT hibernate_sequence.nextval AS memberId FROM DUAL
		</selectKey>-->
		insert into
		info_t_member
		(MEMBER_ID,
		FAMILY_ID,
		RELMASTER,
		MEMBERNAME,
		PAPERTYPE,
		PAPERID,
		BIRTHDAY,
		SEX,
		NATION,
		ISMARRIAGE,
		POLITICAL,
		RPRKIND,
		RPRTYPE,
		RPRADDRESS,
		DEGREESORT,
		POLICY,
		FTAP,
		FTAPLEVEL,
		SICKEN,
		DEFORMITY,
		OLDANDINFIRM,
		WORKABILITY,
		PICPATH,
		student,HEALTH,OTHERREASON,INDI_ID
		)
		values
		(#memberId#,
		#familyId#,
		#relmaster#,
		#membername#,
		#papertype#,
		#paperid#,
		#birthday#,
		#sex#,
		#nation#,
		#ismarriage#,
		#political#,
		#rprkind#,
		#rprtype#,
		#rpraddress#,
		#degreesort#,
		#policy#,
		#ftap#,
		#ftaplevel#,
		#sicken#,
		#deformity#,
		#oldandinfirm#,
		#workability#,
		#picpath#,
		#student#,
		#health#,
		#otherreason#,#indiId#
		)
	</insert>
	<update id="updateMember" parameterClass="InfoTMember">
		update info_t_member
		set
		relmaster = #relmaster#,
		membername = #membername#,
		papertype =
		#papertype#,
		paperid = #paperid#,
		birthday = #birthday#,
		sex =#sex#,
		nation =#nation#,
		ismarriage =#ismarriage#,
		political = #political#,
		rprkind =#rprkind#,
		rprtype = #rprtype#,
		rpraddress = #rpraddress#,
		degreesort
		=#degreesort#,
		policy = #policy#,
		ftap = #ftap#,
		ftaplevel = #ftaplevel#,
		sicken =
		#sicken#,
		deformity = #deformity#,
		oldandinfirm = #oldandinfirm#,
		workability =
		#workability#,
		picpath = #picpath#, student =
		#student#,health=#health#,otherreason =#otherreason#,indi_id=#indiId#
		where member_id =
		#memberId#
	</update>
	<update id="updateMemberPicpath" parameterClass="InfoTMember">
		update
		info_t_member set picpath = #picpath# where member_id = #memberId#;
	</update>
	<delete id="deleteMember" parameterClass="int">
		delete info_t_member
		where member_id =#memberId#
	</delete>
	<update id="updateMemberByPrimaryKeySelective" parameterClass="InfoTMember">
		<!--
			WARNING - This element is automatically generated by Abator for
			iBATIS, do not modify. This element was generated on Mon Apr 13
			09:49:51 CST 2009.
		-->
		update INFO_T_MEMBER
		<dynamic prepend="set">
			<isNotNull prepend="," property="familyId">
				FAMILY_ID =
				#familyId:DECIMAL#
      </isNotNull>
			<isNotNull prepend="," property="relmaster">
				RELMASTER =
				#relmaster:DECIMAL#
      </isNotNull>
			<isNotNull prepend="," property="membername">
				MEMBERNAME =
				#membername:VARCHAR#
      </isNotNull>
			<isNotNull prepend="," property="papertype">
				PAPERTYPE =
				#papertype:DECIMAL#
      </isNotNull>
			<isNotNull prepend="," property="paperid">
				PAPERID = #paperid:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="birthday">
				BIRTHDAY = #birthday:DATE#
			</isNotNull>
			<isNotNull prepend="," property="sex">
				SEX = #sex:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="nation">
				NATION = #nation:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="ismarriage">
				ISMARRIAGE =
				#ismarriage:DECIMAL#
      </isNotNull>
			<isNotNull prepend="," property="political">
				POLITICAL =
				#political:DECIMAL#
      </isNotNull>
			<isNotNull prepend="," property="rprkind">
				RPRKIND = #rprkind:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="rprtype">
				RPRTYPE = #rprtype:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="rpraddress">
				RPRADDRESS =
				#rpraddress:VARCHAR#
      </isNotNull>
			<isNotNull prepend="," property="degreesort">
				DEGREESORT =
				#degreesort:DECIMAL#
      </isNotNull>
			<isNotNull prepend="," property="policy">
				POLICY = #policy:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="ftap">
				FTAP = #ftap:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="ftap">
				FTAPLEVEL = #ftaplevel:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="sicken">
				SICKEN = #sicken:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="deformity">
				DEFORMITY =
				#deformity:DECIMAL#
      </isNotNull>
			<isNotNull prepend="," property="oldandinfirm">
				OLDANDINFIRM =
				#oldandinfirm:DECIMAL#
      </isNotNull>
			<isNotNull prepend="," property="workability">
				WORKABILITY =
				#workability:DECIMAL#
      </isNotNull>
			<isNotNull prepend="," property="picpath">
				PICPATH = #picpath:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="student">
				STUDENT = #student:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="health">
				HEALTH = #health:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="otherreason">
				OTHERREASON =
				#otherreason:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="indiId">
				indi_id =
				#indiId:VARCHAR#
      </isNotNull>
		</dynamic>
		where MEMBER_ID = #memberId:DECIMAL#
	</update>
	<delete id="deleteMemberByPrimaryKey" parameterClass="int">
		delete
		info_t_memberclass where member_id =#memberId#
  </delete>
	<!--  <select id="getMemberPk" resultClass="InfoTMemberResult" >
		SELECT
		hibernate_sequence.nextval AS memberId FROM DUAL
  </select>-->
	<update id="updateFamilyCount" parameterClass="int">
		update info_t_family fam
   set fam.population  = (select count(1)
                            from info_t_member m
                           where m.family_id = #familyId#),
       fam.ensurecount = (select count(1)
                            from info_t_member m
                           where m.family_id = #familyId#
                             and m.rprtype = 261)
 where fam.family_id = #familyId#
  </update>
</sqlMap>